{"version":3,"sources":["assets/Script/GameView.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import GameModel from \"./Model/GameModel\";\nimport BetAreaLayout from \"./BetAreaLayout\";\nimport ChipButtonLayout from \"./ChipButtonLayout\";\n\nimport { NewRoundModelStruct, SetteModelStruct, UserScoreModelStruct } from \"./Common/ModelStruct\";\nimport SettleLabel from \"./SettleLabel\";\nimport CommonButton from \"./CommonButton\";\n\nconst {ccclass, property} = cc._decorator;\n\n@ccclass\nexport default class GameView extends cc.Component {\n    // onLoad () {}\n    private _gameModel: GameModel;\n    private _countdownLabel: cc.Label;\n    private _userScoreLabel: cc.Label;\n    private _settleLabel: SettleLabel;\n    private _confirmButton: CommonButton;\n    private _cancelButton: CommonButton;\n    private _betAreaLayout: BetAreaLayout;\n    private _chipButtonLayout: ChipButtonLayout;\n    private _stateTime: number;\n    private _userScore: number;\n\n    onLoad(){\n        this._countdownLabel = this.node.getChildByName(\"CountdownLabel\").getComponent(cc.Label);\n        this._userScoreLabel = this.node.getChildByName(\"UserScoreLabel\").getComponent(cc.Label);\n        this._settleLabel = this.node.getChildByName(\"SettleLabel\").getComponent(\"SettleLabel\");\n        this._confirmButton = this.node.getChildByName(\"ConfirmButton\").getComponent(\"CommonButton\");\n        this._cancelButton = this.node.getChildByName(\"CancelButton\").getComponent(\"CommonButton\");\n        this._betAreaLayout = this.node.getChildByName(\"BetAreaLayout\").getComponent(\"BetAreaLayout\");\n        this._chipButtonLayout = this.node.getChildByName(\"ChipButtonLayout\").getComponent(\"ChipButtonLayout\");\n        this._stateTime = 0;\n        this._userScore = 0;\n        this._gameModel = new GameModel(this._onEventListener.bind(this));\n        this._init();\n    };\n\n    update(dt: number){\n        this._countdownLabel.string = Math.ceil((this._stateTime / 1000)).toString();\n        this._stateTime -= dt * 1000;\n    };\n\n    private _init(){\n        let eventDispatcher = this._onEventListener.bind(this);\n        this._confirmButton.setType(this._confirmButton.BUTTON_TYPE.CONFIRM);\n        this._confirmButton.setEventDispatcher(eventDispatcher);\n        this._confirmButton.registerClickEvent();\n\n        this._cancelButton.setType(this._confirmButton.BUTTON_TYPE.CANCEL);\n        this._cancelButton.setEventDispatcher(eventDispatcher);\n        this._cancelButton.registerClickEvent();\n\n        this._betAreaLayout.setEventDispatcher(eventDispatcher);\n        this._gameModel.login();\n    };\n\n    private _onEventListener(event: any, data: any){\n        if (event == this._gameModel.MODEL_EVENT.NEW_ROUND) {\n            this._onReceiveNewRound(data);\n        } else if (event == this._gameModel.MODEL_EVENT.SETTLE) {\n            this._onReceiveSettle(data);\n        } else if (event == this._gameModel.MODEL_EVENT.SYNC_USER_SCORE) {\n            this._onReceiveSyncUserBet(data);\n        } else if (event == this._betAreaLayout.VIEW_EVENT.ON_CLICK_AREA) {\n            let totalScore = this._betAreaLayout.getTotalBetScore();\n            let selectValue = this._chipButtonLayout.getSelectValue();\n            if ((selectValue + totalScore) > this._userScore)\n                return;\n\n            this._setUserScoreLabel(this._userScore - totalScore - selectValue);\n            this._betAreaLayout.showBetAnim(data, selectValue);\n        } else if (event == this._cancelButton.VIEW_EVENT.CANCEL) {\n            this._betAreaLayout.cancelBet();\n            this._setUserScoreLabel(this._userScore);\n        } else if (event == this._cancelButton.VIEW_EVENT.CONFIRM) {\n            this._gameModel.userBet(this._betAreaLayout.getBetScores());\n            this._betAreaLayout.confirmBet();\n        };\n    };\n\n    private _onReceiveNewRound(struct: NewRoundModelStruct){\n        this._stateTime = struct.stateTime;\n        this._userScore = struct.userScore;\n        this._settleLabel.reset();\n        this._betAreaLayout.reset();\n        this._betAreaLayout.setTouchEnabled(true);\n        this._setUserScoreLabel(struct.userScore);\n    };\n\n    private _onReceiveSettle(struct: SetteModelStruct){\n        this._stateTime = struct.stateTime;\n        this._userScore = struct.userScore;\n        this._betAreaLayout.cancelBet();\n        this._betAreaLayout.setTouchEnabled(false);\n        this._settleLabel.showSettleText(struct.winArea, struct.settleScore);\n        this._setUserScoreLabel(struct.userScore);\n    };\n\n    private _onReceiveSyncUserBet(struct: UserScoreModelStruct){\n        this._userScore = struct.userScore;\n        this._setUserScoreLabel(struct.userScore);\n    };\n\n    private _setUserScoreLabel(score: number){\n        this._userScoreLabel.string = \"财产: \" + score.toString();\n    };\n};\n"]}